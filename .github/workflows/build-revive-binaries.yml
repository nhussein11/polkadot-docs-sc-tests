name: Build Revive Binaries

on:
  workflow_dispatch:
    inputs:
      polkadot-sdk-ref:
        required: true
        type: string
  schedule:
    - cron: '0 2 * * *'

jobs:
  build-binaries:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Rust
        uses: ./.github/actions/setup-rust

      - name: Fetch SDK
        id: fetch
        uses: ./.github/actions/fetch-polkadot-sdk
        with:
          ref: ${{ inputs.polkadot-sdk-ref }}

      - name: Build binaries
        run: |
          cd polkadot-sdk
          cargo build --locked --release \
            -p revive-dev-node --bin revive-dev-node \
            -p pallet-revive-eth-rpc --bin eth-rpc

      - name: Upload binaries
        uses: actions/upload-artifact@v4
        with:
          name: revive-binaries-${{ inputs.polkadot-sdk-ref }}
          path: |
            polkadot-sdk/target/release/revive-dev-node
            polkadot-sdk/target/release/eth-rpc
          retention-days: 30


